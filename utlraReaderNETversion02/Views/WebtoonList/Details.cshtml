@using Microsoft.AspNetCore.Identity
@using System.Security.Claims
@inject SignInManager<ApplicationUser> SignInManager

@model WebtoonInfo
@{
    // Webtoon adı, ilgili controller'dan ViewData aracılığıyla gönderiliyor.
    var webtoonName = ViewData["WebtoonName"] as string;
    ViewData["Title"] = Model.Title;
    Layout = "_Layout";
}

<div class="container py-5">
    <div class="row g-5">
        <!-- Kapak Görseli Bölümü -->
        <div class="col-md-4 text-center">
            <img src="@Url.Content($"~/webtoons/{webtoonName}/{Model.Cover ?? "default-cover.jpg"}")"
                 class="img-fluid rounded shadow"
                 alt="@Model.Title" style="max-height: 400px;" />
        </div>

        <!-- Webtoon Bilgi Bölümü -->
        <div class="col-md-8">
            <h2 class="mb-3 fw-bold">@Model.Title</h2>
            <div class="mb-2"><strong>Yazar:</strong> @Model.Author</div>
            <div class="mb-2"><strong>Tür:</strong> @Model.Genre</div>
            <div class="mb-2"><strong>Durum:</strong> @Model.Status</div>
            <div class="mb-4">
                <strong>Açıklama:</strong>
                <p class="mt-1 text-muted">@Model.Description</p>
            </div>

            @* Kullanıcı giriş yapmadıysa uyarı ver, aksi halde bölüm listesine yönlendiren buton veya kontrol ekleyebilirsin *@
            @if (!SignInManager.IsSignedIn(User))
            {
                <div class="alert alert-warning">
                    <strong>Not:</strong> Bölümleri görüntülemek için lütfen
                    <a asp-area="Identity" asp-page="/Account/Login" asp-route-returnUrl="@Url.Action("Details", "Webtoon", new { name = webtoonName })" class="alert-link">giriş yapın</a>.
                </div>
            }
        </div>
    </div>

    <!-- Bölüm Listesi -->
    @if (Model.Chapters != null && Model.Chapters.Any())
    {
        <hr />
        <h4 class="mt-5 mb-3">Bölümler</h4>
        <ul class="list-group">
            @foreach (var chapter in Model.Chapters.OrderByDescending(c => c.Number))
            {
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <a asp-controller="Webtoon" asp-action="ReadChapter" asp-route-name="@webtoonName" asp-route-chapter="@chapter.Number" class="text-decoration-none">
                        Bölüm @chapter.Number - @chapter.Title
                    </a>
                    <span class="text-muted small">@chapter.ReleaseDate.ToShortDateString()</span>
                </li>
            }
        </ul>
    }
</div>
